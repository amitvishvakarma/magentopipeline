<?php $order = $block->getOrder(); $account = $block->getAccount(); $modifiedOrderData = $order->getModifiedOrderData(); $modifiedOrderData = ($modifiedOrderData) ? $block->jsonHelper->unserialize($modifiedOrderData) : []; $orderData = $block->jsonHelper->unserialize($order->getOrderData()); $pricingHelper = $block->getData('pricingViewModel'); $regionProvider = $block->getRegionProvider(); ?> <section class="admin__page-section order-view-account-information"><div class="admin__page-section-title"><span class="title"><?= /* @noEscape */ __('Order &amp; Account Information'); ?></span></div><div class="admin__page-section-content"><div class="admin__page-section-item order-information"><div class="admin__page-section-item-title"><span class="title"><?= /* @noEscape */ __('Order %1', $orderData['marketplace_reference_id']); ?></span></div><div class="admin__page-section-item-content"><table class="admin__table-secondary order-information-table"><tbody><tr><th><?= /* @noEscape */ __('Order Date'); ?></th><td><?= /* @noEscape */ $orderData['created_at'] ?></td></tr><tr><th><?= /* @noEscape */ __('Order Status'); ?></th><td><span id="order_status"><?= /* @noEscape */ $order->getMarketplaceOrderStatus() ?></span></td></tr><tr><th><?= /* @noEscape */ __('Account'); ?></th><td><?= /* @noEscape */ ($account) ? $account->getData(\Ced\ConnectBase\Model\Account::TITLE_COLUMN_NAME) : $order->getAccountId(); ?></td></tr><tr></tr><tr><th><?= /* @noEscape */ __('Order Currency'); ?></th><td><?= /* @noEscape */ $orderData['marketplace_currency'] ?? $orderData['currency'] ?? null; ?></td></tr></tbody></table></div></div><div class="admin__page-section-item order-account-information"><div class="admin__page-section-item-title"><span class="title"><?= /* @noEscape */ __('Account Information'); ?></span></div><div class="admin__page-section-item-content"><table class="admin__table-secondary order-account-information-table"><tbody><tr><th><?= /* @noEscape */ __('Customer Name'); ?></th><td><?= /* @noEscape */ $orderData['customer']['name'] ?></td></tr><tr><th><?= /* @noEscape */ __('Email'); ?></th><td><a href="mailto:<?= /* @noEscape */ $orderData['customer']['email'] ?>"><?= /* @noEscape */ $orderData['customer']['email'] ?></a></td></tr></tbody></table></div></div></div></section><section class="admin__page-section order-addresses"><div class="admin__page-section-title"><span class="title"><?= /* @noEscape */ __('Address Information'); ?></span></div><?php $billingShippingSame = true; $origBillingAddress = $origShippingAddress = $shippingAddress = []; if (isset($modifiedOrderData['recipient_address']['region']) && $modifiedOrderData['recipient_address']['region'] && $modifiedOrderData['recipient_address']['state'] == '' ) { $modifiedOrderData['recipient_address']['state'] = $modifiedOrderData['recipient_address']['region']; } if (isset($modifiedOrderData['billing_address']['region']) && $modifiedOrderData['billing_address']['region'] && $modifiedOrderData['billing_address']['state'] == '' ) { $modifiedOrderData['billing_address']['state'] = $modifiedOrderData['billing_address']['region']; } if (isset($orderData['shipping_address'])) { $orderData['shipping_address'] = $orderData['shipping_address'][0] ?? $orderData['shipping_address']; $orderData['shipping_address']['full_address'] = $orderData['shipping_address']['address_line_1'] . ' ' . ( (isset($orderData['shipping_address']['address_line_2'])) ? $orderData['shipping_address']['address_line_2'] : '' ) . ' ' . ( (isset($orderData['shipping_address']['address_line_3'])) ? $orderData['shipping_address']['address_line_3'] : '' ); $origShippingAddress = $orderData['shipping_address']; $shippingAddress = array_replace( $orderData['shipping_address'], $modifiedOrderData['recipient_address'] ?? [] ); } $origBillingAddress = $origShippingAddress; $billingAddress = $shippingAddress; if (isset($orderData['billing_address']) && (!isset($orderData['billing_address']['same_as_shipping']) || !$orderData['billing_address']['same_as_shipping']) ) { $orderData['billing_address'] = $orderData['billing_address'][0] ?? $orderData['billing_address']; $billingShippingSame = false; $orderData['billing_address']['full_address'] = $orderData['billing_address']['address_line_1'] . ' ' . ( (isset($orderData['billing_address']['address_line_2'])) ? $orderData['billing_address']['address_line_2'] : '' ) . ' ' . ( (isset($orderData['billing_address']['address_line_3'])) ? $orderData['billing_address']['address_line_3'] : '' ); $origBillingAddress = $orderData['billing_address']; $billingAddress = array_replace( $orderData['billing_address'], $modifiedOrderData['billing_address'] ?? [] ); } ?> <div class="admin__page-section-content"><div class="admin__page-section-item order-billing-address"><div class="admin__page-section-item-title"><span class="title"><?= /* @noEscape */ __('Billing Address'); ?></span> <?php if (!$order->getIncrementId()): ?> <div class="actions"><a href="#" class="action order-billing-address edit"><span><?= /* @noEscape */ $block->escapeHtml(__("Edit")) ?></span></a></div><?php endif; ?></div><address class="admin__page-section-item-content"><span class="recipient-name"><?= /* @noEscape */ $billingAddress['name'] ?></span> <span> <?= /* @noEscape */ (isset($origBillingAddress['name']) && $origBillingAddress['name'] != $billingAddress['name']) ? ' <b>{ ' . $origBillingAddress['name'] . ' }</b> ' : ''; ?></span> <br/><span class="recipient-full_address"><?= /* @noEscape */ $billingAddress['full_address'] ?></span> <span> <?= /* @noEscape */ (isset($origBillingAddress['full_address']) && $origBillingAddress['full_address'] != $billingAddress['full_address']) ? ' <b>{ ' . $origBillingAddress['full_address'] . ' }</b> ' : ''; ?></span> <br/><span class="recipient-city"><?= /* @noEscape */ $billingAddress['city'] ?></span> <span> <?= /* @noEscape */ (isset($origBillingAddress['city']) && $origBillingAddress['city'] != $billingAddress['city']) ? ' <b>{ ' . $origBillingAddress['city'] . ' }</b> ' : ''; ?></span>, <span class="recipient-state"><?= /* @noEscape */ $billingAddress['state'] ?></span> <span> <?= /* @noEscape */ (isset($origBillingAddress['state']) && $origBillingAddress['state'] != $billingAddress['state']) ? ' <b>{ ' . $origBillingAddress['state'] . ' }</b> ' : ''; ?></span> <br/><span class="recipient-country"><?= /* @noEscape */ $billingAddress['country'] ?></span> <span class="recipient-country_code"><?= /* @noEscape */ $billingAddress['country_code'] ?></span> <span> <?= /* @noEscape */ (isset($origBillingAddress['country']) && $origBillingAddress['country'] != $billingAddress['country']) ? ' <b>{ ' . $origBillingAddress['country'] . ' }</b> ' : ''; ?></span> <span class="recipient-zip"><?= /* @noEscape */ $billingAddress['zip'] ?></span> <span> <?= /* @noEscape */ (isset($origBillingAddress['zip']) && $origBillingAddress['zip'] != $billingAddress['zip']) ? ' <b>{ ' . $origBillingAddress['zip'] . ' }</b> ' : ''; ?></span> <br/> T: <span class="recipient-phone"><?= /* @noEscape */ $billingAddress['phone'] ?></span> <span> <?= /* @noEscape */ (isset($origBillingAddress['phone']) && $origBillingAddress['phone'] != $billingAddress['phone']) ? ' <b>{ ' . $origBillingAddress['phone'] . ' }</b> ' : ''; ?></span></address></div><div class="admin__page-section-item order-shipping-address"><div class="admin__page-section-item-title"><span class="title"><?= /* @noEscape */ __('Shipping Address'); ?></span> <?php if (!$billingShippingSame && !$order->getIncrementId()): ?> <div class="actions"><a href="#" class="action order-shipping-address edit"><span><?= /* @noEscape */ $block->escapeHtml(__("Edit")) ?></span></a></div><?php endif; ?></div><address class="admin__page-section-item-content"><?php if ($billingShippingSame): ?> <?= /* @noEscape */ __('Same as Billing Address'); ?> <?php else: ?> <span class="recipient-name"><?= /* @noEscape */ $shippingAddress['name'] ?></span> <span> <?= /* @noEscape */ (isset($origShippingAddress['name']) && $origShippingAddress['name'] != $shippingAddress['name']) ? ' <b>{ ' . $origShippingAddress['name'] . ' }</b> ' : ''; ?></span> <br/><span class="recipient-full_address"><?= /* @noEscape */ $shippingAddress['full_address'] ?></span> <span> <?= /* @noEscape */ (isset($origShippingAddress['full_address']) && $origShippingAddress['full_address'] != $shippingAddress['full_address']) ? ' <b>{ ' . $origShippingAddress['full_address'] . ' }</b> ' : ''; ?></span> <br/><span class="recipient-city"><?= /* @noEscape */ $shippingAddress['city'] ?></span> <span> <?= /* @noEscape */ (isset($origShippingAddress['city']) && $origShippingAddress['city'] != $shippingAddress['city']) ? ' <b>{ ' . $origShippingAddress['city'] . ' }</b> ' : ''; ?></span>, <span class="recipient-state"><?= /* @noEscape */ $shippingAddress['state'] ?></span> <span> <?= /* @noEscape */ (isset($origShippingAddress['state']) && $origShippingAddress['state'] != $shippingAddress['state']) ? ' <b>{ ' . $origShippingAddress['state'] . ' }</b> ' : ''; ?></span> <br/><span class="recipient-country"><?= /* @noEscape */ $shippingAddress['country'] ?></span> <span class="recipient-country_code"><?= /* @noEscape */ $shippingAddress['country_code'] ?></span> <span> <?= /* @noEscape */ (isset($origShippingAddress['country']) && $origShippingAddress['country'] != $shippingAddress['country']) ? ' <b>{ ' . $origShippingAddress['country'] . ' }</b> ' : ''; ?></span> <span class="recipient-zip"><?= /* @noEscape */ $shippingAddress['zip'] ?></span> <span> <?= /* @noEscape */ (isset($origShippingAddress['zip']) && $origShippingAddress['zip'] != $shippingAddress['zip']) ? ' <b>{ ' . $origShippingAddress['zip'] . ' }</b> ' : ''; ?></span> <br/> T: <span class="recipient-phone"><?= /* @noEscape */ $shippingAddress['phone'] ?></span> <span> <?= /* @noEscape */ (isset($origShippingAddress['phone']) && $origShippingAddress['phone'] != $shippingAddress['phone']) ? ' <b>{ ' . $origShippingAddress['phone'] . ' }</b> ' : ''; ?></span> <?php endif; ?></address></div></div></section><section class="admin__page-section order-view-billing-shipping"><div class="admin__page-section-title"><span class="title"><?= /* @noEscape */ __('Payment &amp; Shipping Method'); ?></span></div><div class="admin__page-section-content"><div class="admin__page-section-item order-payment-method"><div class="admin__page-section-item-title"><span class="title"><?= /* @noEscape */ __('Payment Information'); ?></span></div><div class="admin__page-section-item-content"><div class="order-payment-method-title"><?= /* @noEscape */ ((isset($orderData['payment_info']['payment_method'])) ? $orderData['payment_info']['payment_method'] : 'N/A'); ?></div><div class="order-payment-currency"><?= /* @noEscape */ __('The order was placed using %1', $orderData['marketplace_currency'] ?? $orderData['currency'] ?? null); ?></div></div></div></div></section><section class="admin__page-section"><div class="admin__page-section-title"><span class="title"><?= /* @noEscape */ __('Items Ordered'); ?></span></div><?= /* @noEscape */ $block->getChildHtml('marketplace_order_items') ?></section><section class="admin__page-section"><div class="admin__page-section-title"><span class="title"><?= /* @noEscape */ __('Additional Info'); ?></span></div><?= /* @noEscape */ $block->getChildHtml('additional_order_info') ?></section><section class="admin__page-section"><div class="admin__page-section-title"><span class="title"><?= /* @noEscape */ __('Order Total'); ?></span></div><div class="admin__page-section-content"><div class="admin__page-section-item order-totals"><table class="data-table admin__table-secondary order-subtotal-table"><tfoot><tr class="col-0"><td class="label"><strong><?= /* @noEscape */ __('Grand Total'); ?></strong></td><td><strong> <span class="price"><?= /* @noEscape */ $pricingHelper->getFormattedPrice( $orderData['total']['price'], $orderData['marketplace_currency'] ?? $orderData['currency'] ?? null ); ?></span></strong></td></tr></tfoot><tbody><tr class="col-1"><td class="label"><?= /* @noEscape */ __('Shipping and Handling'); ?></td><td><span> <span class="price"><?= /* @noEscape */ $pricingHelper->getFormattedPrice( $orderData['shipping_charge']['price'], $orderData['marketplace_currency'] ?? $orderData['currency'] ?? null ); ?></span></span></td></tr><tr><td class="label"><div class="summary-collapse" tabindex="0"><?= /* @noEscape */ __('Tax'); ?></div></td><td><span class="price"><?= /* @noEscape */ $pricingHelper->getFormattedPrice( $orderData['tax']['price'], $orderData['marketplace_currency'] ?? $orderData['currency'] ?? null ); ?></span></td></tr><tr><td class="label"><div class="summary-collapse" tabindex="0"><?= /* @noEscape */ __('Discount'); ?></div></td><td><span class="price"><?= /* @noEscape */ $pricingHelper->getFormattedPrice( $orderData['discount']['price'] ?? 0, $orderData['marketplace_currency'] ?? $orderData['currency'] ?? null ); ?></span></td></tr></tbody></table></div></div></section><?= /* @noEscape */ $block->getChildHtml('marketplace_address_popup'); ?> <?php $_displayAll = 'true'; ?> <script type="text/x-magento-init">
    {
        "#country": {
            "directoryRegionUpdater": {
                "optionalRegionAllowed": <?= /* @noEscape */ $_displayAll ? 'true' : 'false' ?>,
                "regionListId": "#state",
                "regionInputId": "#states",
                "postcodeId": "#postcode",
                "form": "#form-validate",
                "regionJson": <?= /* @noEscape */ $regionProvider->getRegionJson(); ?>,
                "defaultRegion": "<?= (int)$block->getRegionId() ?>",
                "countriesWithOptionalZip": <?= /* @noEscape */ $regionProvider->getCountriesWithOptionalZip(true) ?>
    }
}
}</script>